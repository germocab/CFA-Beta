<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Turnos Predicaci√≥n</title>
  <style>
    /* VARIABLES DE COLOR */
    :root {
      /* Modo Oscuro (Default) */
      --bg-body: #1e1e1e;
      --bg-screen: #121212;
      --bg-card: #1e1e1e;
      --bg-card-active: #252525;
      --text-main: #ffffff;
      --text-dim: #a0a0a0;
      --border-color: transparent;
      --shadow: none;
      
      /* Colores fijos */
      --primary-orange: #f36100;
      --bg-card-blue: #2c2c3e;
      --green: #04c92f;
      --radius: 24px;
    }

    /* MODO CLARO */
    body.light-mode {
      --bg-body: #f0f2f5;
      --bg-screen: #ffffff;
      --bg-card: #f8f9fa;
      --bg-card-active: #ffffff;
      --text-main: #1a1a1a;
      --text-dim: #65676b;
      --border-color: #e4e6eb;
      --shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    * { box-sizing: border-box; transition: background-color 0.3s, color 0.3s; }
    
    body { margin: 0; font-family: 'Segoe UI', sans-serif; background-color: var(--bg-body); color: var(--text-main); display: flex; justify-content: center; min-height: 100vh; }
    
    .app-wrapper { display: grid; grid-template-columns: 1fr; gap: 20px; width: 100%; max-width: 1100px; padding: 20px; }
    
    .screen { background-color: var(--bg-screen); border-radius: var(--radius); overflow: hidden; height: 850px; display: flex; flex-direction: column; box-shadow: var(--shadow); border: 1px solid var(--border-color); }
    .scroll-container { padding: 20px; overflow-y: auto; flex-grow: 1; }
    
    /* HEADER CON TOGGLE */
    .header-list { display: flex; justify-content: space-between; align-items: center; padding: 30px 20px 10px 25px; }
    
    .theme-toggle {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      color: var(--text-main);
      padding: 8px 12px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 0.8rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: var(--shadow);
    }

    /* TARJETAS */
    .location-card { padding: 20px; border-radius: var(--radius); margin-bottom: 12px; cursor: pointer; border: 2px solid transparent; background-color: var(--bg-card); display: flex; align-items: center; gap: 15px; box-shadow: var(--shadow); }
    .location-card.active { border-color: var(--primary-orange); background-color: var(--bg-card-active); }
    .status-dot { width: 12px; height: 12px; border-radius: 50%; flex-shrink: 0; }
    .card-label h2 { margin: 0; font-size: 0.95rem; font-weight: 600; color: var(--text-main); }

    /* DETALLE */
    .hero-img { height: 220px; background-size: cover; background-position: center; position: relative; background-color: #333; }
    .hero-img::after { 
        content: ""; position: absolute; inset: 0; 
        background: linear-gradient(to top, var(--bg-screen) 5%, transparent 60%); 
    }
    
    .back-btn { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.6); border: none; color: white; padding: 10px 18px; border-radius: 20px; cursor: pointer; z-index: 20; font-weight: bold; display: none; }

    .info-section { padding: 30px 35px; }
    .info-section h2 { margin: 0 0 25px 0; font-size: 1.8rem; font-weight: 700; }
    .days-row { display: flex; gap: 10px; margin-bottom: 30px; overflow-x: auto; padding-bottom: 10px; }
    .day-btn { flex: 1; min-width: 55px; text-align: center; color: var(--text-dim); cursor: pointer; font-weight: 700; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 999px; background: rgba(128,128,128,0.1); }
    .day-btn.active { background: var(--text-main); color: var(--bg-screen); }
    
    .slot { padding: 22px; border-radius: var(--radius); margin-bottom: 15px; color: white; }
    .turno-M { background-color: var(--primary-orange); }
    .turno-T { background-color: var(--bg-card-blue); }
    .slot h4 { margin: 0 0 10px 0; font-size: 1.1rem; }
    .badge { background: rgba(255,255,255,0.2); padding: 6px 16px; border-radius: 12px; font-size: 0.85rem; }

    /* RESPONSIVE */
    @media (min-width: 768px) { 
      .app-wrapper { grid-template-columns: 350px 1fr; } 
      #detail-screen { display: flex !important; } 
    }
    @media (max-width: 767px) { 
      .app-wrapper { padding: 0; } 
      .screen { height: 100vh; border-radius: 0; border: none; } 
      #detail-screen { display: none; }
      .back-btn { display: block; }
    }
  </style>
</head>
<body>
  <div class="app-wrapper">
    <section class="screen" id="list-screen">
      <div class="header-list">
        <h1 style="margin:0; font-size: 1.6rem;">Locaciones</h1>
        <button class="theme-toggle" onclick="toggleTheme()" id="themeBtn">
          <span>üåô</span> Modo
        </button>
      </div>
      <div class="scroll-container" id="locationsList"></div>
    </section>

    <section class="screen" id="detail-screen">
      <div class="hero-img" id="heroBanner">
        <button class="back-btn" onclick="goBack()">‚Üê Volver</button>
      </div>
      <div class="info-section">
        <h2 id="currentPointTitle">Seleccione punto</h2>
        <div class="days-row">
          <div class="day-btn active" onclick="setDay('Lunes', this)">Lun</div>
          <div class="day-btn" onclick="setDay('Martes', this)">Mar</div>
          <div class="day-btn" onclick="setDay('Miercoles', this)">Mie</div>
          <div class="day-btn" onclick="setDay('Jueves', this)">Jue</div>
          <div class="day-btn" onclick="setDay('Viernes', this)">Vie</div>
          <div class="day-btn" onclick="setDay('Sabado', this)">Sab</div>
          <div class="day-btn" onclick="setDay('Domingo', this)">Dom</div>
        </div>
        <div id="slotsContainer">Cargando turnos...</div>
      </div>
    </section>
  </div>

  <script>
    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT22dGTCsHGc5Qj4EbMxn4XqPoPuUI93UblvVlwu0nPm4FOUzMvLCIv5eTCgjQXS3MiNamBMsBdJ45A/pub?output=csv';

    const POINT_CONFIG = {
      "Cl√≠nica Cordillera": { img: "https://images.unsplash.com/photo-1519494026892-80bbd2d6fd0d?auto=format&fit=crop&q=80&w=1000", color: "#f36100" },
      "Supermercado Lider": { img: "https://images.unsplash.com/photo-1534452203293-494d7ddbf7e0?auto=format&fit=crop&q=80&w=1000", color: "#0056ff" },
      "Santa Zita": { img: "https://appassets.mvtdev.com/map/41/st/642/2193637.webp", color: "#04c92f" },
      "Visviri/Supermercado Santa Isabel": { img: "https://images.unsplash.com/photo-1441986300917-64674bd600d8?auto=format&fit=crop&q=80&w=1000", color: "#f36100" },
      "Feria de Francisco Bilbao (Curaco)": { img: "https://images.unsplash.com/photo-1488459711626-9c000639443c?auto=format&fit=crop&q=80&w=1000", color: "#0056ff" },
      "Parque Intercomunal": { img: "https://images.unsplash.com/photo-1585822310497-99b50e6fd373?auto=format&fit=crop&q=80&w=1000", color: "#04c92f" },
      "Patricia": { img: "https://images.unsplash.com/photo-1517021897933-0e0319cfbc28?auto=format&fit=crop&q=80&w=1000", color: "#f36100" }
    };

    let allData = [];
    let currentDay = 'Lunes';
    let currentPointName = "Cl√≠nica Cordillera";

    function toggleTheme() {
      const isLight = document.body.classList.toggle('light-mode');
      document.getElementById('themeBtn').innerHTML = isLight ? '<span>‚òÄÔ∏è</span> Claro' : '<span>üåô</span> Oscuro';
    }

    function init() {
      const listContainer = document.getElementById('locationsList');
      Object.keys(POINT_CONFIG).forEach((name) => {
        const card = document.createElement('div');
        card.className = `location-card ${name === currentPointName ? 'active' : ''}`;
        card.onclick = () => selectPoint(name);
        card.innerHTML = `<div class="status-dot" style="background-color: ${POINT_CONFIG[name].color};"></div><div class="card-label"><h2>${name}</h2></div>`;
        listContainer.appendChild(card);
      });
      loadExcelData();
    }

    async function loadExcelData() {
      try {
        const response = await fetch(SHEET_URL);
        const csvText = await response.text();
        const rows = csvText.split(/\r?\n/).slice(1); 
        allData = rows.map(row => {
          const separator = row.includes(';') ? ';' : ',';
          const cols = row.split(separator);
          return {
            punto: (cols[0] || "").replace(/["']/g, "").trim(),
            dia: (cols[1] || "").replace(/["']/g, "").trim(),
            hora: (cols[2] || "").replace(/["']/g, "").trim(),
            nombres: (cols[3] || "").replace(/["']/g, "").trim()
          };
        });
        renderShifts();
      } catch (e) { console.error("Error:", e); }
    }

    function selectPoint(name) {
      currentPointName = name;
      document.getElementById('currentPointTitle').innerText = name;
      document.getElementById('heroBanner').style.backgroundImage = `url('${POINT_CONFIG[name].img}')`;
      document.querySelectorAll('.location-card').forEach(c => {
        c.classList.toggle('active', c.innerText.includes(name));
      });
      if (window.innerWidth < 768) {
        document.getElementById('list-screen').style.display = 'none';
        document.getElementById('detail-screen').style.display = 'flex';
      }
      renderShifts();
    }

    function goBack() {
      document.getElementById('list-screen').style.display = 'flex';
      document.getElementById('detail-screen').style.display = 'none';
    }

    function setDay(day, element) {
      currentDay = day;
      document.querySelectorAll('.day-btn').forEach(btn => btn.classList.remove('active'));
      element.classList.add('active');
      renderShifts();
    }

    function renderShifts() {
      const container = document.getElementById('slotsContainer');
      const dayShort = currentDay.toLowerCase().substring(0, 3);
      const filtered = allData.filter(row => 
        row.punto.toLowerCase() === currentPointName.toLowerCase() && 
        row.dia.toLowerCase().includes(dayShort)
      );

      if (filtered.length === 0) {
        container.innerHTML = `<div style="padding:40px; color:var(--text-dim); text-align:center;">No hay turnos.</div>`;
        return;
      }

      container.innerHTML = filtered.map((shift, index) => `
        <div class="slot ${index % 2 === 0 ? 'turno-M' : 'turno-T'}">
          <h4>${shift.nombres}</h4>
          <div class="badge">${shift.hora}</div>
        </div>
      `).join('');
    }

    window.onload = init;
  </script>
</body>
</html>
